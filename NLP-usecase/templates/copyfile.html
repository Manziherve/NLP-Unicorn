<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Design Generation - MYPROJECT</title>

  <!-- Preload critique -->
  <link rel="preload" href="{{ url_for('static', filename='css/styles.css') }}" as="style">
  
  <!-- CSS principal -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- Scripts avec defer -->
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script src="{{ url_for('static', filename='js/copyfile.js') }}" defer></script>
</head>
<body>
  <!-- Site Header -->
  <header class="site-header">
    <div class="container header-container">
      <a href="{{ url_for('index') }}" class="logo">Company</a>
      <nav class="main-nav">
        <ul class="nav-list">
          <li><a href="{{ url_for('index') }}" class="nav-link">Generate Copy</a></li>
          <li><a href="{{ url_for('copyfile') }}" class="nav-link active">Generate Design</a></li>
          <li><a href="{{ url_for('comparefiles') }}" class="nav-link">Compare Files</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main Content Container - Full Height -->
  <main class="main-container main-container--fullscreen">
    
    <!-- Upload/Load Section -->
    <section class="upload-section card">
      <h1>Design File Generation</h1>
      
      <!-- Option 1: Load from previous page -->
      <div id="loadFromMemory" class="form-field" style="display: none;">
        <p class="load-message">
          ✅ Copy loaded from previous step
        </p>
        <button id="useLoadedCopyBtn" class="btn btn--success">
          Use Loaded Copy
        </button>
      </div>

      <!-- Option 2: Manual file upload -->
      <div id="manualUpload" class="form-field">
        <label for="copyFileInput" class="form-label">Or load a copy file (.docx)</label>
        <input type="file" accept=".docx" id="copyFileInput" class="file-input">
      </div>

      <button id="generateDesignBtn" class="btn btn--primary" disabled>
        Generate Design
      </button>
    </section>

    <!-- Content Display Section -->
    <section id="contentDisplay" class="content-display" style="display: none;">
      
      <!-- Single Content Mode (before generation) -->
      <div id="copyOnlyMode" class="single-content">
        <h3>Copy Content</h3>
        <textarea id="copyContent" readonly class="content-textarea"></textarea>
      </div>

      <!-- Dual Content Mode (after generation) -->
      <div id="dualDesignMode" class="dual-content" style="display: none;">
        <div class="content-column">
          <h3>Original Copy</h3>
          <textarea id="copyContentReadonly" readonly class="content-textarea"></textarea>
        </div>
        
        <div class="content-column">
          <h3>Designed Copy (editable)</h3>
          <div id="designedCopyContainer" class="designed-copy-container">
            <div id="designedCopyPreview" class="designed-copy-preview"></div>
            <textarea id="designedCopySource" class="content-textarea designed-copy-source" style="display: none;"></textarea>
          </div>
          <div class="design-controls">
            <button id="toggleViewBtn" class="btn btn--outline btn--sm">Switch to HTML View</button>
          </div>
        </div>
      </div>

      <!-- Confirmed Design Mode (final design display) -->
      <div id="confirmedDesignMode" class="single-content" style="display: none;">
        <h3 class="confirmed">Confirmed Marketing Design</h3>
        <div class="document-preview">
          <div id="confirmedDesignPreview" class="designed-copy-final"></div>
        </div>
      </div>
    </section>

    <!-- Design Quality Metrics -->
    <section id="designMetricsSection" class="comparison-section card--compact" style="display: none;">
      <h3>Design Quality Analysis</h3>
      <div class="comparison-metrics">
        <div class="metric">
          <span class="metric-label">Layout:</span>
          <span id="layoutQuality" class="metric-value">0%</span>
        </div>
        <div class="metric">
          <span class="metric-label">Typography:</span>
          <span id="typographyQuality" class="metric-value">0%</span>
        </div>
        <div class="metric">
          <span class="metric-label">Visual Impact:</span>
          <span id="visualImpact" class="metric-value">0%</span>
        </div>
        <div class="metric">
          <span class="metric-label">Brand Consistency:</span>
          <span id="brandConsistency" class="metric-value">0%</span>
        </div>
      </div>
    </section>

    <!-- Modification Warning -->
    <div id="designWarning" class="modification-warning" style="display: none;">
      <p>⚠️ You have made changes to the generated design. Please confirm your changes to continue.</p>
    </div>

    <!-- Action Buttons -->
    <section class="actions-section">
      <div class="btn-group">
        <button id="resetBtn" class="btn btn--secondary">Reset</button>
        <button id="backBtn" class="btn btn--outline">Back to Copy</button>
        
        <!-- Phase 2: After generation, before confirmation -->
        <button id="confirmDesignBtn" class="btn btn--success" style="display: none;">Confirm Design</button>
        
        <!-- Phase 3: After confirmation -->
        <button id="downloadDesignBtn" class="btn btn--primary" style="display: none;">Download Design</button>
        <button id="nextPageBtn" class="btn btn--primary" disabled>Compare Files</button>
      </div>
    </section>

  </main>
</body>
</html>